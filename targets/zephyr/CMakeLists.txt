cmake_minimum_required(VERSION 3.13.1)
include($ENV{ZEPHYR_BASE}/cmake/app/boilerplate.cmake NO_POLICY_SCOPE)
project(my_zephyr_app)

get_filename_component(__root_dir "${CMAKE_CURRENT_LIST_DIR}/../.." ABSOLUTE)
set(OT_ROOT_DIR ${__root_dir} CACHE INTERNAL "OpenThread source root.")

execute_process(
    COMMAND "${OT_ROOT_DIR}/third_party/nlbuild-autotools/repo/scripts/mkversion" "-b" "`cat .default-version`" "."
    OUTPUT_VARIABLE __version OUTPUT_STRIP_TRAILING_WHITESPACE
)
set(OT_VERSION "${__version}" CACHE INTERNAL "")

FILE(GLOB app_sources src/*.c src/*.cpp)

list(APPEND app_sources
    ${OT_ROOT_DIR}/examples/platforms/utils/settings_ram.c
    ${OT_ROOT_DIR}/src/core/api/border_router_api.cpp
    ${OT_ROOT_DIR}/src/core/api/channel_manager_api.cpp
    ${OT_ROOT_DIR}/src/core/api/channel_monitor_api.cpp
    ${OT_ROOT_DIR}/src/core/api/child_supervision_api.cpp
    ${OT_ROOT_DIR}/src/core/api/coap_api.cpp
    ${OT_ROOT_DIR}/src/core/api/coap_secure_api.cpp
    ${OT_ROOT_DIR}/src/core/api/commissioner_api.cpp
    ${OT_ROOT_DIR}/src/core/api/crypto_api.cpp
    ${OT_ROOT_DIR}/src/core/api/dataset_api.cpp
    ${OT_ROOT_DIR}/src/core/api/dataset_ftd_api.cpp
    ${OT_ROOT_DIR}/src/core/api/dns_api.cpp
    ${OT_ROOT_DIR}/src/core/api/entropy_api.cpp
    ${OT_ROOT_DIR}/src/core/api/icmp6_api.cpp
    ${OT_ROOT_DIR}/src/core/api/instance_api.cpp
    ${OT_ROOT_DIR}/src/core/api/ip6_api.cpp
    ${OT_ROOT_DIR}/src/core/api/jam_detection_api.cpp
    ${OT_ROOT_DIR}/src/core/api/joiner_api.cpp
    ${OT_ROOT_DIR}/src/core/api/link_api.cpp
    ${OT_ROOT_DIR}/src/core/api/link_raw_api.cpp
    ${OT_ROOT_DIR}/src/core/api/logging_api.cpp
    ${OT_ROOT_DIR}/src/core/api/message_api.cpp
    ${OT_ROOT_DIR}/src/core/api/netdata_api.cpp
    ${OT_ROOT_DIR}/src/core/api/network_time_api.cpp
    ${OT_ROOT_DIR}/src/core/api/random_crypto_api.cpp
    ${OT_ROOT_DIR}/src/core/api/random_noncrypto_api.cpp
    ${OT_ROOT_DIR}/src/core/api/server_api.cpp
    ${OT_ROOT_DIR}/src/core/api/sntp_api.cpp
    ${OT_ROOT_DIR}/src/core/api/tasklet_api.cpp
    ${OT_ROOT_DIR}/src/core/api/thread_api.cpp
    ${OT_ROOT_DIR}/src/core/api/thread_ftd_api.cpp
    ${OT_ROOT_DIR}/src/core/api/toble_api.cpp
    ${OT_ROOT_DIR}/src/core/api/udp_api.cpp
    ${OT_ROOT_DIR}/src/core/coap/coap.cpp
    ${OT_ROOT_DIR}/src/core/coap/coap_message.cpp
    ${OT_ROOT_DIR}/src/core/coap/coap_secure.cpp
    ${OT_ROOT_DIR}/src/core/common/crc16.cpp
    ${OT_ROOT_DIR}/src/core/common/entropy.cpp
    ${OT_ROOT_DIR}/src/core/common/instance.cpp
    ${OT_ROOT_DIR}/src/core/common/logging.cpp
    ${OT_ROOT_DIR}/src/core/common/message.cpp
    ${OT_ROOT_DIR}/src/core/common/notifier.cpp
    ${OT_ROOT_DIR}/src/core/common/random_crypto.cpp
    ${OT_ROOT_DIR}/src/core/common/random_manager.cpp
    ${OT_ROOT_DIR}/src/core/common/random_noncrypto.cpp
    ${OT_ROOT_DIR}/src/core/common/settings.cpp
    ${OT_ROOT_DIR}/src/core/common/string.cpp
    ${OT_ROOT_DIR}/src/core/common/tasklet.cpp
    ${OT_ROOT_DIR}/src/core/common/timer.cpp
    ${OT_ROOT_DIR}/src/core/common/tlvs.cpp
    ${OT_ROOT_DIR}/src/core/common/trickle_timer.cpp
    ${OT_ROOT_DIR}/src/core/crypto/aes_ccm.cpp
    ${OT_ROOT_DIR}/src/core/crypto/aes_ecb.cpp
    ${OT_ROOT_DIR}/src/core/crypto/ecdsa.cpp
    ${OT_ROOT_DIR}/src/core/crypto/hmac_sha256.cpp
    ${OT_ROOT_DIR}/src/core/crypto/mbedtls.cpp
    ${OT_ROOT_DIR}/src/core/crypto/pbkdf2_cmac.cpp
    ${OT_ROOT_DIR}/src/core/crypto/sha256.cpp
    ${OT_ROOT_DIR}/src/core/mac/channel_mask.cpp
    ${OT_ROOT_DIR}/src/core/mac/link_raw.cpp
    ${OT_ROOT_DIR}/src/core/mac/mac.cpp
    ${OT_ROOT_DIR}/src/core/mac/mac_filter.cpp
    ${OT_ROOT_DIR}/src/core/mac/mac_frame.cpp
    ${OT_ROOT_DIR}/src/core/mac/sub_mac.cpp
    ${OT_ROOT_DIR}/src/core/mac/sub_mac_callbacks.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/announce_begin_client.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/border_agent.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/commissioner.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/dataset.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/dataset_local.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/dataset_manager.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/dataset_manager_ftd.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/dtls.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/energy_scan_client.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/joiner.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/joiner_router.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/leader.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/meshcop.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/meshcop_tlvs.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/panid_query_client.cpp
    ${OT_ROOT_DIR}/src/core/meshcop/timestamp.cpp
    ${OT_ROOT_DIR}/src/core/net/dhcp6_client.cpp
    ${OT_ROOT_DIR}/src/core/net/dhcp6_server.cpp
    ${OT_ROOT_DIR}/src/core/net/dns_client.cpp
    ${OT_ROOT_DIR}/src/core/net/icmp6.cpp
    ${OT_ROOT_DIR}/src/core/net/ip6.cpp
    ${OT_ROOT_DIR}/src/core/net/ip6_address.cpp
    ${OT_ROOT_DIR}/src/core/net/ip6_filter.cpp
    ${OT_ROOT_DIR}/src/core/net/ip6_headers.cpp
    ${OT_ROOT_DIR}/src/core/net/ip6_mpl.cpp
    ${OT_ROOT_DIR}/src/core/net/ip6_routes.cpp
    ${OT_ROOT_DIR}/src/core/net/netif.cpp
    ${OT_ROOT_DIR}/src/core/net/sntp_client.cpp
    ${OT_ROOT_DIR}/src/core/net/udp6.cpp
    ${OT_ROOT_DIR}/src/core/radio/radio_callbacks.cpp
    ${OT_ROOT_DIR}/src/core/radio/radio_platform.cpp
    ${OT_ROOT_DIR}/src/core/radio/radio_toble.cpp
    ${OT_ROOT_DIR}/src/core/thread/address_resolver.cpp
    ${OT_ROOT_DIR}/src/core/thread/announce_begin_server.cpp
    ${OT_ROOT_DIR}/src/core/thread/announce_sender.cpp
    ${OT_ROOT_DIR}/src/core/thread/child_table.cpp
    ${OT_ROOT_DIR}/src/core/thread/data_poll_manager.cpp
    ${OT_ROOT_DIR}/src/core/thread/energy_scan_server.cpp
    ${OT_ROOT_DIR}/src/core/thread/key_manager.cpp
    ${OT_ROOT_DIR}/src/core/thread/link_quality.cpp
    ${OT_ROOT_DIR}/src/core/thread/lowpan.cpp
    ${OT_ROOT_DIR}/src/core/thread/mesh_forwarder.cpp
    ${OT_ROOT_DIR}/src/core/thread/mesh_forwarder_ftd.cpp
    ${OT_ROOT_DIR}/src/core/thread/mesh_forwarder_mtd.cpp
    ${OT_ROOT_DIR}/src/core/thread/mle.cpp
    ${OT_ROOT_DIR}/src/core/thread/mle_router.cpp
    ${OT_ROOT_DIR}/src/core/thread/network_data.cpp
    ${OT_ROOT_DIR}/src/core/thread/network_data_leader.cpp
    ${OT_ROOT_DIR}/src/core/thread/network_data_leader_ftd.cpp
    ${OT_ROOT_DIR}/src/core/thread/network_data_local.cpp
    ${OT_ROOT_DIR}/src/core/thread/network_diagnostic.cpp
    ${OT_ROOT_DIR}/src/core/thread/panid_query_server.cpp
    ${OT_ROOT_DIR}/src/core/thread/router_table.cpp
    ${OT_ROOT_DIR}/src/core/thread/src_match_controller.cpp
    ${OT_ROOT_DIR}/src/core/thread/thread_netif.cpp
    ${OT_ROOT_DIR}/src/core/thread/time_sync_service.cpp
    ${OT_ROOT_DIR}/src/core/thread/topology.cpp
    ${OT_ROOT_DIR}/src/core/toble/adv_data.cpp
    ${OT_ROOT_DIR}/src/core/toble/toble.cpp
    ${OT_ROOT_DIR}/src/core/toble/platform.cpp
    ${OT_ROOT_DIR}/src/core/toble/conn_table.cpp
    ${OT_ROOT_DIR}/src/core/toble/controller_peripheral.cpp
    ${OT_ROOT_DIR}/src/core/toble/controller_central.cpp
    ${OT_ROOT_DIR}/src/core/toble/btp.cpp
    ${OT_ROOT_DIR}/src/core/toble/btp_client.cpp
    ${OT_ROOT_DIR}/src/core/toble/btp_server.cpp
    ${OT_ROOT_DIR}/src/core/toble/transport.cpp
    ${OT_ROOT_DIR}/src/core/utils/channel_manager.cpp
    ${OT_ROOT_DIR}/src/core/utils/channel_monitor.cpp
    ${OT_ROOT_DIR}/src/core/utils/child_supervision.cpp
    ${OT_ROOT_DIR}/src/core/utils/heap.cpp
    ${OT_ROOT_DIR}/src/core/utils/jam_detector.cpp
    ${OT_ROOT_DIR}/src/core/utils/missing_strlcpy.c
    ${OT_ROOT_DIR}/src/core/utils/parse_cmdline.cpp
    ${OT_ROOT_DIR}/src/core/utils/slaac_address.cpp
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/aes.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/asn1parse.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/asn1write.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/base64.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/bignum.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ccm.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/cipher.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/cipher_wrap.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/cmac.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ctr_drbg.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/debug.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ecdh.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ecdsa.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ecjpake.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ecp.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ecp_curves.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/entropy.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/entropy_poll.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/md.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/md_wrap.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/memory_buffer_alloc.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/oid.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/pem.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/pk.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/pk_wrap.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/pkparse.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/platform.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/platform_util.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/sha256.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ssl_cookie.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ssl_ciphersuites.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ssl_cli.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ssl_srv.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ssl_ticket.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/ssl_tls.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/threading.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/x509.c
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/library/x509_crt.c
)

target_sources(app PRIVATE ${app_sources})

target_compile_definitions(app PRIVATE
    -DOPENTHREAD_FTD=1
    -DOPENTHREAD_SETTINGS_RAM=1
    -DOPENTHREAD_CONFIG_ENABLE_BUILTIN_MBEDTLS=1
    -DOPENTHREAD_CONFIG_ENABLE_TOBLE=1
    -DOPENTHREAD_CONFIG_TOBLE_CENTRAL_ENABLE=1
    -DOPENTHREAD_CONFIG_TOBLE_PERIPHERAL_ENABLE=1
    -DMBEDTLS_CONFIG_FILE="mbedtls-config.h"
    -DPACKAGE_NAME="OPENTHREAD"
    -DPACKAGE_VERSION="${OT_VERSION}"
)

target_include_directories(app PRIVATE
    ${OT_ROOT_DIR}/include
    ${OT_ROOT_DIR}/etc/cmake
    ${OT_ROOT_DIR}/src/core
    ${OT_ROOT_DIR}/third_party/mbedtls
    ${OT_ROOT_DIR}/third_party/mbedtls/repo/include
    $ENV{BSIM_COMPONENTS_PATH}/libUtilv1/src
    $ENV{BSIM_COMPONENTS_PATH}/libPhyComv1/src
)
